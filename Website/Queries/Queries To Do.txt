 SQL Queries

Add Car

INSTERT INTO car (Vehicle_Sno, model_name, car_type, LocationName, color, hourly_rate, daily_rate, seating_capacity, transmission_type,
	bluetooth_connectivity, auxilary_cable)
VALUES ($Vehicle_Sno, $model_name, $car_type, $LocationName, $color, $hourly_rate, $daily_rate, $seating_capacity, $transmission_type,
	$bluetooth_connectivity, $auxilary_cable)

Administrative report:

Select car.VehicleSno, car.Type, car.CarModel, (SUM(EstimatedCost)) AS cost, (SUM(LateFees)) AS late_fees
FROM reservation INNER JOIN car ON reservation.VehicleSno=car.VehicleSno
WHERE DATE_SUB(CURDATE(),INTERVAL 3 MONTH) < PickUpDateTime AND 
CURDATE() > PickUpDateTime
Group By VehicleSno
ORDER BY Type

Frequent Users Report;

SELECT Username, Driving_Plan,  Count(Pick_Up_Date) AS No. Reservations per month
FROM GT_student_faculty_member INNER JOIN Reservation ON
GT_student_faculty_member.Username=Reservation.Username
WHERE DATEDIFF(MONTH, Pick_Up_Date, CURRDATE()) < 3
GROUP BY Username
ORDER BY No. Reservations per month DESC
LIMIT 5

Location Preference Report

SELECT 'PickUpDateTime' AS 'Month', ReservationLocation AS Location, Count(*) AS Total, Count('PickUpDateTime') AS Reservations
FROM Location INNER JOIN Reservation
ORDER BY Month DESC

viewing rental info for employees
SELECT * FROM Reservation




extend reservation time(done by employee when user calls)
INSERT INTO Reservation_Extended_Time (username,pickup_datetime,extended_time,return_datetime)
VALUES ($customerusername,(SELECT pickup_date_time FROM Reservation WHERE Username=$customerusername),$extendedtime,
(SELECT return_date_time FROM Reservation WHERE Username=$customerusername)+$extendedtime)
WHERE username=$customerusername

rental request change
UPDATE Reservation SET (pickup_datetime,ReturnDateTime,EstimatedCost,LocationName,VehicleSno)
VALUES ($pickuptime,$returntime,($returntime-$pickuptime)*(SELECT hourly_rate FROM car WHERE VehicleSno=$vehiclesno),
(SELECT location FROM car WHERE VehicleSno=$vehiclesno),$vehiclesno)
WHERE VehicleSno=$vehiclesno AND pick_up_time<current_timestamp

Semantic Constraint: check that the capacity of the location is not exceeded
Count(SELECT VehicleSno FROM car WHERE Locationname = $locationName 

Maintainence History (selected either by which car request was for or which user put it in)
SELECT * FROM maintainence_request_problems WHERE VehicleSno=$vehiclesno
or
SELECT * FROM maintainence_request_problems WHERE Username=$username

Manage cars
Semantic constraint to make sure that we cant change a car location if the location capacity will be exceeded
	WHERE VehicleSno=$vehiclesno AND COUNT(SELECT VehicleSno FROM car WHERE location_name = $location) < SELECT Location.capacity
					FROM Location WHERE
					Location.Name = $location
(used in queries below)


UPDATE car SET (location_name) VALUES ($location)
WHERE VehicleSno=$vehiclesno AND COUNT(SELECT VehicleSno FROM car WHERE location_name = $location) < SELECT Location.capacity
					FROM Location WHERE
					Location.Name = $location



INSERT INTO car (Vehicle_Sno,auxilary_cable,under_maintainence_flag,model_name,car_type,color,hourly_rate,daily_rate,blutoothe_connectivity,seating_capacity,Location_name,transmission_type)
VALUES ($vehiclesno,$auxcable,$undermaintainence,$modelname,$cartype,$color,$hourly,$daily,$bluetooth,$seating,$location,$transmission) WHERE VehicleSno=$vehiclesno AND COUNT(SELECT VehicleSno FROM car WHERE location_name = $location) < SELECT Location.capacity
					FROM Location WHERE
					Location.Name = $location

Maintenance Requests
SELECT Location_Name FROM Location

SELECT Make, Model FROM Car INNER JOIN Location ON Location.Location_Name=Car.Location_Name
WHERE Car.Location_Name=$Location_Name

UPDATE Car SET (maintenance_flag) VALUES (YES)
WHERE Location_Name=$Location_Name AND Make=$Make AND Model=$Model

